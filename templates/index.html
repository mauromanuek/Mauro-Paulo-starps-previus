<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Sniper Intelligence Bot</title>
    <style>
        body { background: #0b0e11; color: #fff; font-family: sans-serif; text-align: center; margin: 0; padding: 20px; }
        .card { background: #181a20; border: 1px solid #333; padding: 20px; border-radius: 12px; max-width: 600px; margin: auto; margin-bottom: 20px; }
        #log-area { background: #000; color: #00ff41; height: 160px; overflow-y: auto; text-align: left; padding: 10px; font-family: monospace; font-size: 13px; border: 1px solid #333; }
        .signal-view { font-size: 3.5em; font-weight: 900; padding: 25px; border-radius: 10px; background: #23272e; margin: 15px 0; border: 2px solid #444; }
        .sniper-mode { border: 8px solid #f0b90b !important; box-shadow: 0 0 35px #f0b90b; background: #2b2100 !important; }
        .status-on { color: #02c076; font-weight: bold; }
        .status-off { color: #f84960; font-weight: bold; }
        select, input { width: 90%; padding: 12px; margin: 10px 0; background: #000; color: #fff; border: 1px solid #444; border-radius: 5px; }
        button { padding: 15px 30px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin: 5px; }
    </style>
</head>
<body>
    <audio id="beep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

    <div class="card">
        <h2>ðŸŽ¯ SNIPER INTELLIGENCE</h2>
        <input type="text" id="token" placeholder="Insira seu Token API">
        <select id="symbol">
            <option value="R_10">Volatility 10</option>
            <option value="R_25">Volatility 25</option>
            <option value="R_50">Volatility 50</option>
            <option value="R_75">Volatility 75</option>
            <option value="R_100" selected>Volatility 100</option>
        </select>
        <br>
        <button style="background: #02c076; color: white;" onclick="run('start')">LIGAR MOTOR</button>
        <button style="background: #f84960; color: white;" onclick="run('stop')">DESLIGAR</button>
        <p>STATUS: <span id="st-text" class="status-off">OFF</span></p>
    </div>

    <div id="main-card" class="card">
        <div id="sym-name" style="color: #f0b90b; font-weight: bold;">AGUARDANDO ATIVO...</div>
        <div id="dir" class="signal-view">---</div>
        <p id="just">O bot decidirÃ¡ a melhor estratÃ©gia (Sniper ou Fluxo) automaticamente.</p>
        <div style="display: flex; justify-content: space-around; font-size: 1.2em;">
            <span>ESTRATÃ‰GIA: <strong id="strat">--</strong></span>
            <span>CONFIANÃ‡A: <strong id="conf" style="color: #f0b90b;">0</strong>%</span>
        </div>
    </div>

    <div class="card">
        <pre id="log-area">Aguardando comando...</pre>
    </div>

    <script>
        const beep = document.getElementById('beep');
        let last = "";

        async function run(a) {
            beep.play().catch(()=>{});
            await fetch('/control', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({action: a, token: document.getElementById('token').value, symbol: document.getElementById('symbol').value})
            });
        }

        setInterval(async () => {
            try {
                const res = await fetch('/status');
                const d = await res.json();
                
                document.getElementById('st-text').innerText = d.status;
                document.getElementById('st-text').className = d.status === 'ON' ? 'status-on' : 'status-off';
                
                const logs = document.getElementById('log-area');
                logs.innerText = d.logs.join('\n');
                logs.scrollTop = logs.scrollHeight;

                const s = d.signal;
                document.getElementById('dir').innerText = s.direction;
                document.getElementById('just').innerText = s.justification;
                document.getElementById('strat').innerText = s.strategy_used;
                document.getElementById('conf').innerText = s.confidence;
                document.getElementById('sym-name').innerText = `ANALISANDO: ${s.symbol_name}`;

                const box = document.getElementById('dir');
                const card = document.getElementById('main-card');

                if(s.direction === 'CALL') box.style.color = '#02c076';
                else if(s.direction === 'PUT') box.style.color = '#f84960';
                else box.style.color = '#fff';

                if(s.confidence >= 98) {
                    card.classList.add('sniper-mode');
                    if(last !== s.direction) beep.play();
                } else {
                    card.classList.remove('sniper-mode');
                }
                last = s.direction;
            } catch(e){}
        }, 2000);
    </script>
</body>
</html>
